<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dead By Daylight Scoreboard Settings</title>
<style>
  :root{
    --bg0:#07080c; --bg1:#0b0c10;
    --card: rgba(255,255,255,.06);
    --border: rgba(255,255,255,.10);
    --muted2: rgba(255,255,255,.55);
    --pink:#f2b7e6;
    --pill: rgba(160,160,190,.25);
    --shadow: 0 18px 60px rgba(0,0,0,.45);
    --shadow2: 0 10px 35px rgba(0,0,0,.35);
    --radius: 22px;
  }
  html,body{
    margin:0;
    background:
      radial-gradient(1100px 700px at 30% 20%, rgba(255,74,24,.10), transparent 60%),
      radial-gradient(900px 600px at 70% 40%, rgba(120,160,255,.10), transparent 60%),
      linear-gradient(180deg, var(--bg0), var(--bg1));
    color:#e9e9e9;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
  }
  .wrap{ min-height:100vh; display:grid; place-items:center; padding: 26px 16px 44px; }
  .container{ width: min(1180px, 100%); display:grid; gap: 14px; }

  .hero{
    position: relative; border-radius: 34px;
    background: linear-gradient(90deg, rgba(190,170,255,.22), rgba(160,220,255,.14));
    box-shadow: var(--shadow); padding: 22px 22px 18px; overflow:hidden; text-align:center;
  }
  .hero::before{
    content:""; position:absolute; inset:-60px;
    background:
      radial-gradient(900px 300px at 25% 70%, rgba(255,74,24,.18), transparent 60%),
      radial-gradient(700px 260px at 70% 40%, rgba(255,255,255,.10), transparent 60%);
    filter: blur(18px); opacity: .9; pointer-events:none;
  }
  .heroInner{ position:relative; z-index:2; }
  .heroTitle{ margin:0; font-size: clamp(34px, 5vw, 62px); font-weight: 1000; letter-spacing: .6px; }
  .heroSub{ margin-top: 6px; font-size: 18px; letter-spacing: 2px; font-weight: 1000; color: var(--pink); text-transform: uppercase; }

  .grid{ display:grid; grid-template-columns: 1fr 1fr; gap: 14px; }
  @media (max-width: 980px){ .grid{ grid-template-columns: 1fr; } }

  .card{
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 16px;
    box-shadow: var(--shadow2);
    backdrop-filter: blur(8px);
  }
  .chip{
    display:inline-flex; align-items:center; gap: 10px;
    padding: 10px 14px; border-radius: 999px;
    background: var(--pill);
    border: 1px solid rgba(255,255,255,.10);
    margin-bottom: 8px;
  }
  .skull{
    width: 28px; height: 28px; display:grid; place-items:center;
    border-radius: 999px; background: rgba(0,0,0,.32);
    border: 1px solid rgba(255,255,255,.08);
    font-size: 16px;
  }
  .card h2{ margin:0; font-size: 18px; font-weight: 1000; letter-spacing: .3px; }

  .row{
    display:grid;
    grid-template-columns: 1fr auto;
    gap: 12px;
    align-items:center;
    margin: 10px 0;
  }
  label{ color: rgba(255,255,255,.90); font-weight: 800; }
  .hint{ color: var(--muted2); font-size: 12px; margin-top: 2px; }

  input[type="text"], input[type="number"], select, textarea{
    width: 360px; max-width: 100%;
    padding: 10px 12px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.32);
    color: #fff;
    outline: none;
  }
  textarea{ min-height: 120px; resize: vertical; }
  input[type="number"]{ width: 140px; }
  input[type="color"]{ width: 58px; height: 40px; border-radius: 12px; border: none; background: transparent; padding: 0; }
  input[type="range"]{ width: 360px; max-width:100%; }
  input[type="file"]{ width: 360px; max-width: 100%; }

  .btns{ display:flex; gap: 10px; flex-wrap: wrap; margin-top: 12px; }
  button{
    padding: 10px 14px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,.16);
    background: rgba(255,255,255,.10);
    color:#fff;
    font-weight: 900;
    cursor:pointer;
  }
  button:hover{ background: rgba(255,255,255,.14); }
  .wide{ grid-column: 1 / -1; }
  .split{ display:grid; grid-template-columns: 1fr 1fr; gap: 14px; }
  @media (max-width: 980px){ .split{ grid-template-columns:1fr; } }
  hr{ border:none; border-top:1px solid rgba(255,255,255,.12); margin: 14px 0; }
</style>
</head>

<body>
<div class="wrap">
  <div class="container">
    <div class="hero">
      <div class="heroInner">
        <h1 class="heroTitle">DBD Scoreboard</h1>
        <div class="heroSub">Settings â€¢ v5.3 (Blood)</div>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="chip"><div class="skull">ðŸ’€</div><h2>Basics</h2></div>

        <div class="row">
          <div>
            <label>Twitch Channel</label>
            <div class="hint">Chat: !dbdwin / !dbdlose / !dbdreset / !dbdset 3 2</div>
          </div>
          <input id="channel" type="text" placeholder="ghostephace">
        </div>

        <div class="row">
          <div><label>Commands allowed</label><div class="hint">Mods only recommended</div></div>
          <select id="allowEveryone">
            <option value="false">Broadcaster/Mods only</option>
            <option value="true">Everyone</option>
          </select>
        </div>

        <div class="row">
          <div><label>Visibility</label><div class="hint">Command mode = show briefly after updates</div></div>
          <select id="visibility">
            <option value="always">Always</option>
            <option value="command">Command mode</option>
          </select>
        </div>

        <div class="row">
          <div><label>Show seconds (command mode)</label></div>
          <input id="showSeconds" type="range" min="2" max="30" step="1">
        </div>

        <div class="row">
          <div><label>Hide initially (command mode)</label></div>
          <select id="hideInitially">
            <option value="true">Yes</option>
            <option value="false">No</option>
          </select>
        </div>

        <div class="btns">
          <button id="btnReset">Reset Scores</button>
        </div>
      </div>

      <div class="card">
        <div class="chip"><div class="skull">ðŸ§ª</div><h2>Score Test</h2></div>

        <div class="row"><div><label>Win</label></div><input id="scoreWin" type="number" min="0" max="99"></div>
        <div class="row"><div><label>Lose</label></div><input id="scoreLose" type="number" min="0" max="99"></div>

        <div class="btns">
          <button id="btnWinPlus">Win +1</button>
          <button id="btnLosePlus">Lose +1</button>
          <button id="btnApplyScores">Apply</button>
          <button id="btnZero">Zero</button>
        </div>

        <div class="hint" style="margin-top:10px;">
          Streamlabs cache fix: bump overlay URL ?v=1 â†’ ?v=2
        </div>
      </div>

      <div class="card wide">
        <div class="chip"><div class="skull">âœ¨</div><h2>Icons (Upload + Tint)</h2></div>

        <div class="split">
          <div>
            <div class="row"><div><label>Left label</label></div><input id="leftLabel" type="text"></div>
            <div class="row"><div><label>Left icon mode</label></div>
              <select id="leftIconMode"><option value="svg">SVG</option><option value="upload">Upload PNG</option></select>
            </div>
            <div class="row"><div><label>Left SVG</label></div>
              <select id="leftIconSvg"><option value="trophy">trophy</option><option value="skull">skull</option><option value="exit">exit</option><option value="sad">sad</option></select>
            </div>
            <div class="row"><div><label>Left PNG upload</label></div><input id="leftFile" type="file" accept="image/png"></div>
            <div class="row"><div><label>Left tint</label></div>
              <select id="leftTintOn"><option value="true">On</option><option value="false">Off</option></select>
            </div>
            <div class="row"><div><label>Left tint color</label></div><input id="leftTintColor" type="color"></div>
          </div>

          <div>
            <div class="row"><div><label>Right label</label></div><input id="rightLabel" type="text"></div>
            <div class="row"><div><label>Right icon mode</label></div>
              <select id="rightIconMode"><option value="svg">SVG</option><option value="upload">Upload PNG</option></select>
            </div>
            <div class="row"><div><label>Right SVG</label></div>
              <select id="rightIconSvg"><option value="sad">sad</option><option value="skull">skull</option><option value="exit">exit</option><option value="trophy">trophy</option></select>
            </div>
            <div class="row"><div><label>Right PNG upload</label></div><input id="rightFile" type="file" accept="image/png"></div>
            <div class="row"><div><label>Right tint</label></div>
              <select id="rightTintOn"><option value="true">On</option><option value="false">Off</option></select>
            </div>
            <div class="row"><div><label>Right tint color</label></div><input id="rightTintColor" type="color"></div>
          </div>
        </div>

        <div class="hint" style="margin-top:10px;">
          Upload icons are saved to the browser storage you upload from.
        </div>
      </div>

      <div class="card wide">
        <div class="chip"><div class="skull">ðŸ”¥</div><h2>Blood Drips</h2></div>

        <div class="split">
          <div>
            <div class="row">
              <div><label>Enable blood</label></div>
              <select id="bloodOn"><option value="true">On</option><option value="false">Off</option></select>
            </div>
            <div class="row"><div><label>Blood color</label></div><input id="bloodColor" type="color"></div>
            <div class="row"><div><label>Opacity</label></div><input id="bloodOpacity" type="range" min="0" max="1" step="0.01"></div>
            <div class="row"><div><label>Drip rate (per sec)</label></div><input id="bloodRate" type="range" min="0" max="3" step="0.05"></div>
          </div>

          <div>
            <div class="row"><div><label>Speed</label></div><input id="bloodSpeed" type="range" min="0.2" max="3" step="0.05"></div>
            <div class="row"><div><label>Length</label></div><input id="bloodLength" type="range" min="0" max="1" step="0.01"></div>
            <div class="row"><div><label>Thickness</label></div><input id="bloodThickness" type="range" min="0" max="1" step="0.01"></div>
            <div class="row"><div><label>Wobble</label></div><input id="bloodWobble" type="range" min="0" max="1" step="0.01"></div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<script>
  const STORAGE_KEY = "dbd_widget_live";

  const DEFAULTS = {
    channel: "ghostephace",
    allowEveryone: false,
    scoreWin: 0,
    scoreLose: 0,
    visibility: "always",
    showSeconds: 8,
    hideInitially: true,

    effects: {
      bloodOn: true,
      bloodColor: "#8b0000",
      bloodOpacity: 0.85,
      bloodRate: 0.55,
      bloodSpeed: 1.05,
      bloodLength: 0.75,
      bloodThickness: 0.70,
      bloodWobble: 0.60
    },

    textIcons: {
      leftLabel:"killed", rightLabel:"failed",
      leftIconMode:"svg", rightIconMode:"svg",
      leftIconSvg:"trophy", rightIconSvg:"sad",
      leftIconData:"", rightIconData:"",
      leftTintOn:true, rightTintOn:true,
      leftTintColor:"#FF4500", rightTintColor:"#FF4500"
    }
  };

  const $ = (id) => document.getElementById(id);

  function deepMerge(base, patch){
    const out = { ...base };
    for(const k of Object.keys(patch || {})){
      const v = patch[k];
      if(v && typeof v === "object" && !Array.isArray(v)) out[k] = deepMerge(base[k] || {}, v);
      else out[k] = v;
    }
    return out;
  }

  function loadState(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return structuredClone(DEFAULTS);
      return deepMerge(structuredClone(DEFAULTS), JSON.parse(raw));
    } catch { return structuredClone(DEFAULTS); }
  }

  let state = loadState();
  function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }

  function clamp(n, min=0, max=99){
    n = Number(n);
    if(!Number.isFinite(n)) n = 0;
    return Math.max(min, Math.min(max, Math.round(n)));
  }

  async function fileToDataUrl(file){
    return new Promise((resolve, reject) => {
      const fr = new FileReader();
      fr.onload = () => resolve(fr.result);
      fr.onerror = reject;
      fr.readAsDataURL(file);
    });
  }

  function bind(){
    $("channel").value = state.channel;
    $("allowEveryone").value = String(state.allowEveryone);
    $("visibility").value = state.visibility;
    $("showSeconds").value = state.showSeconds;
    $("hideInitially").value = String(state.hideInitially);

    $("scoreWin").value = state.scoreWin;
    $("scoreLose").value = state.scoreLose;

    $("leftLabel").value = state.textIcons.leftLabel;
    $("rightLabel").value = state.textIcons.rightLabel;
    $("leftIconMode").value = state.textIcons.leftIconMode;
    $("rightIconMode").value = state.textIcons.rightIconMode;
    $("leftIconSvg").value = state.textIcons.leftIconSvg;
    $("rightIconSvg").value = state.textIcons.rightIconSvg;
    $("leftTintOn").value = String(state.textIcons.leftTintOn);
    $("rightTintOn").value = String(state.textIcons.rightTintOn);
    $("leftTintColor").value = state.textIcons.leftTintColor;
    $("rightTintColor").value = state.textIcons.rightTintColor;

    $("bloodOn").value = String(state.effects.bloodOn);
    $("bloodColor").value = state.effects.bloodColor;
    $("bloodOpacity").value = state.effects.bloodOpacity;
    $("bloodRate").value = state.effects.bloodRate;
    $("bloodSpeed").value = state.effects.bloodSpeed;
    $("bloodLength").value = state.effects.bloodLength;
    $("bloodThickness").value = state.effects.bloodThickness;
    $("bloodWobble").value = state.effects.bloodWobble;
  }

  function wire(){
    $("channel").addEventListener("input", () => { state.channel = $("channel").value.trim() || "ghostephace"; saveState(); });
    $("allowEveryone").addEventListener("change", () => { state.allowEveryone = $("allowEveryone").value === "true"; saveState(); });
    $("visibility").addEventListener("change", () => { state.visibility = $("visibility").value; saveState(); });
    $("showSeconds").addEventListener("input", () => { state.showSeconds = clamp($("showSeconds").value,2,30); saveState(); });
    $("hideInitially").addEventListener("change", () => { state.hideInitially = $("hideInitially").value === "true"; saveState(); });

    $("btnReset").addEventListener("click", () => { state.scoreWin = 0; state.scoreLose = 0; saveState(); bind(); });

    $("btnWinPlus").addEventListener("click", () => { state.scoreWin = clamp(state.scoreWin + 1); saveState(); bind(); });
    $("btnLosePlus").addEventListener("click", () => { state.scoreLose = clamp(state.scoreLose + 1); saveState(); bind(); });
    $("btnApplyScores").addEventListener("click", () => {
      state.scoreWin = clamp($("scoreWin").value,0,99);
      state.scoreLose = clamp($("scoreLose").value,0,99);
      saveState();
    });
    $("btnZero").addEventListener("click", () => { state.scoreWin = 0; state.scoreLose = 0; saveState(); bind(); });

    $("leftLabel").addEventListener("input", () => { state.textIcons.leftLabel = $("leftLabel").value.trim() || "killed"; saveState(); });
    $("rightLabel").addEventListener("input", () => { state.textIcons.rightLabel = $("rightLabel").value.trim() || "failed"; saveState(); });

    $("leftIconMode").addEventListener("change", () => { state.textIcons.leftIconMode = $("leftIconMode").value; saveState(); });
    $("rightIconMode").addEventListener("change", () => { state.textIcons.rightIconMode = $("rightIconMode").value; saveState(); });
    $("leftIconSvg").addEventListener("change", () => { state.textIcons.leftIconSvg = $("leftIconSvg").value; saveState(); });
    $("rightIconSvg").addEventListener("change", () => { state.textIcons.rightIconSvg = $("rightIconSvg").value; saveState(); });

    $("leftTintOn").addEventListener("change", () => { state.textIcons.leftTintOn = $("leftTintOn").value === "true"; saveState(); });
    $("rightTintOn").addEventListener("change", () => { state.textIcons.rightTintOn = $("rightTintOn").value === "true"; saveState(); });
    $("leftTintColor").addEventListener("change", () => { state.textIcons.leftTintColor = $("leftTintColor").value; saveState(); });
    $("rightTintColor").addEventListener("change", () => { state.textIcons.rightTintColor = $("rightTintColor").value; saveState(); });

    $("leftFile").addEventListener("change", async (e) => {
      const f = e.target.files?.[0]; if(!f) return;
      state.textIcons.leftIconData = await fileToDataUrl(f);
      state.textIcons.leftIconMode = "upload";
      saveState();
      e.target.value = "";
    });

    $("rightFile").addEventListener("change", async (e) => {
      const f = e.target.files?.[0]; if(!f) return;
      state.textIcons.rightIconData = await fileToDataUrl(f);
      state.textIcons.rightIconMode = "upload";
      saveState();
      e.target.value = "";
    });

    // blood controls
    $("bloodOn").addEventListener("change", () => { state.effects.bloodOn = $("bloodOn").value === "true"; saveState(); });
    $("bloodColor").addEventListener("change", () => { state.effects.bloodColor = $("bloodColor").value; saveState(); });
    $("bloodOpacity").addEventListener("input", () => { state.effects.bloodOpacity = parseFloat($("bloodOpacity").value); saveState(); });
    $("bloodRate").addEventListener("input", () => { state.effects.bloodRate = parseFloat($("bloodRate").value); saveState(); });
    $("bloodSpeed").addEventListener("input", () => { state.effects.bloodSpeed = parseFloat($("bloodSpeed").value); saveState(); });
    $("bloodLength").addEventListener("input", () => { state.effects.bloodLength = parseFloat($("bloodLength").value); saveState(); });
    $("bloodThickness").addEventListener("input", () => { state.effects.bloodThickness = parseFloat($("bloodThickness").value); saveState(); });
    $("bloodWobble").addEventListener("input", () => { state.effects.bloodWobble = parseFloat($("bloodWobble").value); saveState(); });
  }

  bind();
  wire();

  window.addEventListener("storage", (e) => {
    if(e.key !== STORAGE_KEY) return;
    state = loadState();
    bind();
  });
</script>
</body>
</html>
